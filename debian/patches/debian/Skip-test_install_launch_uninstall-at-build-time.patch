From: Simon McVittie <smcv@debian.org>
Date: Tue, 6 Sep 2016 10:38:04 +0100
Subject: Skip test_install_launch_uninstall at build-time

This doesn't seem to work in sbuild.
---
 tests/Makefile.am.inc | 1 +
 tests/testlibrary.c   | 6 ++++++
 2 files changed, 7 insertions(+)

diff --git a/tests/Makefile.am.inc b/tests/Makefile.am.inc
index ec8e9f2..1e86812 100644
--- a/tests/Makefile.am.inc
+++ b/tests/Makefile.am.inc
@@ -1,5 +1,6 @@
 TESTS_ENVIRONMENT += FLATPAK_TESTS_DEBUG=1 \
 	FLATPAK_TRIGGERSDIR=$$(cd $(top_srcdir) && pwd)/triggers \
+	FLATPAK_UNINSTALLED=1 \
 	FLATPAK_DBUSPROXY=$$(cd $(top_builddir) && pwd)/flatpak-dbus-proxy \
 	GI_TYPELIB_PATH=$$(cd $(top_builddir) && pwd) \
 	LD_LIBRARY_PATH=$$(cd $(top_builddir)/.libs && pwd) \
diff --git a/tests/testlibrary.c b/tests/testlibrary.c
index abf5fb6..a972934 100644
--- a/tests/testlibrary.c
+++ b/tests/testlibrary.c
@@ -272,6 +272,12 @@ test_install_launch_uninstall (void)
   gboolean res;
   const char *bwrap = g_getenv ("FLATPAK_BWRAP");
 
+  if (g_getenv ("FLATPAK_UNINSTALLED") != NULL)
+    {
+      g_test_skip ("Not run at build time");
+      return;
+    }
+
   if (bwrap != NULL)
     {
       gint exit_code = 0;
